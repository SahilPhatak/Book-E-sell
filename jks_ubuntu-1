pipeline {
    // agent any
    agent {
        label 'node-1'
    }

    environment {
        WEB_ROOT = '/var/www/html'
        source   = '/home/ubuntu/2095_level'
    }

    stages {
        // stage('Checkout Repository') {
        //     steps {
        //         echo 'üì• Cloning GitHub repository...'
        //         git branch: 'main',
        //             credentialsId: 'a3dfc393-02f4-49f2-bc9d-584e2cb67fbf',
        //             url: 'https://github.com/swapnibrad/3ri_batch_2.git'
        //     }
        // }

        stage('Update & Install NGINX') {
            steps {
                echo 'üß∞ Updating system and installing NGINX...'
                sh '''
                    sudo apt-get update -y
                    sudo apt-get install -y nginx
                    sudo systemctl enable nginx
                    sudo systemctl start nginx
                '''
            }
        }

        stage('Deploy Website') {
            steps {
                echo 'üöÄ Deploying website files to /var/www/html...'
                sh '''
                    sudo rm -rf ${WEB_ROOT}/*
                    sudo cp -r ${source}/ ${WEB_ROOT}/
                    sudo chown -R www-data:www-data ${WEB_ROOT}
                    sudo chmod -R 755 ${WEB_ROOT}
                    mkdir node_123
                '''
            }
        }

        stage('Restart NGINX') {
            steps {
                echo 'üîÅ Restarting NGINX...'
                sh 'sudo systemctl restart nginx'
            }
        }
    }

    post {
        success {
            echo '‚úÖ Deployment successful ‚Äî site is live!'
        }
        failure {
            echo '‚ùå Deployment failed ‚Äî check the logs.'
        }
    }
}